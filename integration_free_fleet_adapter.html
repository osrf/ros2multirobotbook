<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Free Fleet Adapter - Programming Multiple Robots with ROS 2</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="open-in.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Programming Multiple Robots with ROS 2</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/osrf/ros2multirobotbook" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="free-fleet-adapter"><a class="header" href="#free-fleet-adapter">Free Fleet Adapter</a></h1>
<p>The free fleet adapter formerly known as Free Fleet, allows users to integrate standalone mobile robots to form a heterogeneous fleet, to work with Open-RMF.</p>
<p>The <code>free_fleet_adapter</code> implements the Easy Full Control fleet adapter API, and communicates with individual robots over Zenoh bridges. Out-of-the-box, it supports robots running <a href="https://wiki.ros.org/navigation">ROS 1 Navigation</a> as well as <a href="https://github.com/ros-navigation/navigation2">ROS 2 Navigation2</a>.</p>
<p>Check out the <a href="https://github.com/open-rmf/free_fleet?tab=readme-ov-file#simulation-examples">simulation examples</a> for more information.</p>
<p>Below is the ideal integration architecture of several robots that are running either ROS 2 Navigation2 or ROS 1 Navigation.</p>
<img src="https://raw.githubusercontent.com/open-rmf/free_fleet/09562b952a0edea09f042c4b5f6d556f8cebab30/architecture.jpg">
<p>With Zenoh bridges, users should be able to integrate their robot as-is, without additional namespacing. The Zenoh bridges are responsible for filtering topics to reduce network traffic, and to namespace the various Zenoh keys, which the <code>free_fleet_adapter</code> operates on. Handling message definitions across domains have been greatly simplified too, thanks to <a href="https://pypi.org/project/pycdr2/"><code>pycdr2</code></a> for ROS 2 messages and <a href="https://pypi.org/project/rosbags/"><code>rosbags</code></a> for ROS 1 messages.</p>
<h2 id="ros-2-navigation2"><a class="header" href="#ros-2-navigation2">ROS 2 Navigation2</a></h2>
<p>For ROS 2 Navigation2, the integration is enabled by <a href="https://github.com/eclipse-zenoh/zenoh-plugin-ros2dds">zenoh-bridge-ros2dds</a>. With an appropriately configured bridge running on the robot, the <code>free_fleet_adapter</code> is able to communicate and control the robot, via its navigation behavior trees.</p>
<p><img src="https://github.com/open-rmf/free_fleet/blob/media/multirobot_sim_architecture.jpg?raw=true" alt="" /></p>
<p><img src="https://github.com/open-rmf/free_fleet/blob/media/ff_unique_faster_smaller.gif?raw=true" alt="" /></p>
<p>The Navigation2 integration currently uses the simple <code>navigate_to_pose</code> behavior to provide navigation commands from point to point following the RMF waypoints defined. Support for utilizing more Navigation2 behaviors or custom behaviors is on the roadmap, but in the meantime, contributions are always welcome!</p>
<p>Below is an example of the robot defined in the fleet configuration file, you can find the file <a href="https://github.com/open-rmf/free_fleet/blob/main/free_fleet_examples/config/fleet/nav2_tb3_simulation_fleet_config.yaml">here</a>. Take note of the defined <code>navigation_stack</code>, this allows the <code>free_fleet_adapter</code> to pick the <code>Nav2RobotAdapter</code> for this particular robot.</p>
<pre><code class="language-yaml">...
  robots:
    nav2_tb3:
      charger: "tb3_charger"
      responsive_wait: False # Should responsive wait be on/off for this specific robot? Overrides the fleet-wide setting.
      # For Nav2RobotAdapter
      navigation_stack: 2
      initial_map: "L1"
      maps:
        L1:
          map_url: "/opt/ros/jazzy/share/nav2_bringup/maps/tb3_sandbox.yaml"
,,,
</code></pre>
<p>Below is an example of the Zenoh configuration file used by the <code>zenoh-bridge-ros2dds</code> on the robot. The Zenoh keys are namespaced by the <code>namespace</code> parameter, while we are able to filter and rate-limit ROS 2 topics, services, actions to reduce network traffic. With the <code>client</code> mode, the bridge will seek to connect to a locally available Zenoh router.</p>
<pre><code class="language-json5">{
  plugins: {
    ros2dds: {
      namespace: "/nav2_tb3",
      allow: {
        publishers: [".*/tf", ".*/battery_state"],
        subscribers: [],
        service_servers: [],
        service_clients: [],
        action_servers: [".*/navigate_to_pose"],
        action_clients: [],
      },
      pub_max_frequencies: [".*/navigate_to_pose/*=1", ".*/battery_state=1"],
    },
  },
  // Zenoh related configurations
  mode: "client",
  connect: {
    endpoints: []
  },
  listen: {
    endpoints: []
  },
}
</code></pre>
<p>Check out our <a href="https://github.com/open-rmf/free_fleet/blob/main/.github/docker/integration-tests/nav2-docker-compose.yaml">integration test setup</a> to get a better idea on how this integration can be deployed.</p>
<h2 id="ros-1-navigation-stack"><a class="header" href="#ros-1-navigation-stack">ROS 1 Navigation Stack</a></h2>
<div class='warning'>
The zenoh-bridge-ros1 is an experimental bridge, and is actively being iterated on. Especially with <a href="https://wiki.ros.org/Distributions">ROS 1 going EOL in May 2025</a>, users are encouraged to migrate to ROS 2.
<p>The ROS 1 Navigation integration has only been tested in simulation and in ROS 1 Noetic, and is currently still using a fork of <a href="https://github.com/aaronchongth/zenoh-plugin-ros1/tree/namespace">zenoh-plugin-ros1</a>, to support bridge namespacing. This will be updated after contributions to upstream has been made.</p>
</div>
<p>For ROS 1 Navigation, the integration is enabled by <a href="https://github.com/eclipse-zenoh/zenoh-plugin-ros1">zenoh-bridge-ros1</a>. Similarly, with an appropriately configured bridge running on the robot, the <code>free_fleet_adapter</code> is able to communicate and control the robot, via the <code>move_base</code> topics.</p>
<p><img src="https://github.com/open-rmf/free_fleet/blob/media/nav1_sim_architecture.jpg?raw=true" alt="" /></p>
<p>Below is an example of the robot defined in the fleet configuration file, you can find the file <a href="https://github.com/open-rmf/free_fleet/blob/main/free_fleet_examples/config/fleet/nav1_tb3_simulation_fleet_config.yaml">here</a>. Take note of the defined <code>navigation_stack</code>, this allows the <code>free_fleet_adapter</code> to pick the <code>Nav1RobotAdapter</code> for this particular robot.</p>
<pre><code class="language-yaml">...
  robots:
    nav1_tb3:
      charger: "tb3_charger"
      responsive_wait: False # Should responsive wait be on/off for this specific robot? Overrides the fleet-wide setting.
      # For Nav1RobotAdapter
      navigation_stack: 1
      initial_map: "L1"
      maps:
        L1:
          # The nav1 robot will generally no access to this nav2_bringup package, this should point to where the nav1 map is stored.
          map_url: "/tmp/navigation2/nav2_bringup/maps/tb3_sandbox.yaml"
,,,
</code></pre>
<p>Below is an example of the Zenoh configuration file used by the <code>zenoh-bridge-ros1</code> on the robot. The Zenoh keys are namespaced by the <code>bridge_namespace</code> parameter, while we are able to filter ROS 1 topics and services to reduce network traffic. With the <code>client</code> mode, the bridge will seek to connect to a locally available Zenoh router.</p>
<pre><code class="language-json5">{
  plugins: {
    ros1: {
      bridge_namespace: "nav1_tb3",
      subscriber_bridging_mode: "disabled",
      publisher_bridging_mode: "disabled",
      service_bridging_mode: "disabled",
      client_bridging_mode: "disabled",
      // Zenoh -&gt; ROS 1
      subscriber_topic_custom_bridging_mode: {
        "/move_base_simple/goal": "auto",
        "/move_base/cancel": "auto",
      },
      // ROS 1 -&gt; Zenoh
      publisher_topic_custom_bridging_mode: {
        "/tf": "auto",
        "/battery_state": "auto",
        "/move_base/status": "auto"
      },
    },
  },
  // Zenoh related configurations
  mode: "client",
  connect: {
    endpoints: []
  },
  listen: {
    endpoints: []
  },
}
</code></pre>
<p>Check out our <a href="https://github.com/open-rmf/free_fleet/blob/main/.github/docker/integration-tests/nav1-docker-compose.yaml">integration test setup</a> to get a better idea on how this integration can be deployed.</p>
<h2 id="custom-navigation-stack"><a class="header" href="#custom-navigation-stack">Custom Navigation Stack</a></h2>
<p>Users looking to integrate their own custom navigation stack, can implement the abstract interfaces in <code>RobotAdapter</code> <a href="https://github.com/open-rmf/free_fleet/blob/main/free_fleet_adapter/free_fleet_adapter/robot_adapter.py">here</a>.</p>
<p>The implementation will need a name, for the <code>free_fleet_adapter</code> to correctly allocate adapters to each connected robot. This name is configured in the robot's configuration in the fleet configuration file. For example, Navigation2 is just <code>2</code>, while ROS 1 Navigation is <code>1</code>.</p>
<p>Contributions are always welcome!</p>
<h2 id="more-information-and-links"><a class="header" href="#more-information-and-links">More information and links</a></h2>
<ul>
<li><a href="https://github.com/open-rmf/free_fleet">Repository</a></li>
<li>Free fleet <a href="https://github.com/open-rmf/free_fleet/releases/tag/1.3.0">legacy implementation</a> and <a href="./integration_free-fleet.html">documentation page</a>.</li>
<li><a href="https://github.com/eclipse-zenoh/zenoh-plugin-ros2dds">zenoh-bridge-ros2dds</a></li>
<li><a href="https://github.com/aaronchongth/zenoh-plugin-ros1/tree/namespace">Custom zenoh-bridge-ros1 fork</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/osrf/ros2multirobotbook/edit/main/src/integration_free_fleet_adapter.md">Edit this page on GitHub.</a></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="integration_fleets_action_tutorial.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="integration_free-fleet.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="integration_fleets_action_tutorial.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="integration_free-fleet.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
